<div fxLayout="column" class="datos-container">

    <h2 class="titulo">Datos del partido</h2>

    <div *ngIf="cargando" class="cargando">
        <div class="d-flex justify-content-center m-3">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div *ngIf="!cargando" fxFlex="100" fxLayout.sm="row wrap" fxLayoutAlign.sm="center" fxLayout.xs="row wrap" class="acciones text-end">
        <button id="eliminar-partido" (click)="eliminarPartido()"
            fxFlex.xs="100" fxFlex.sm="45" mat-raised-button class="m-1">Eliminar partido</button>
        <button id="modificar-partido" (click)="modificarPartido()"
            fxFlex.xs="100" fxFlex.sm="45" mat-raised-button class="m-1">Modificar datos</button>
        <a id="ver-video-partido" [href]="urlVideoPartido()" target="_blank"
            fxFlex.xs="100" fxFlex.sm="45" mat-raised-button class="m-1">
            Video del partido
        </a>
        <button id="cortes-partido" (click)="generarNuevoCorte()"
            fxFlex.xs="100" fxFlex.sm="45" mat-raised-button class="m-1">Generar nuevo corte</button>
    </div>

    <!-- Cuadro con los datos del partido -->
    <div class="info-content" *ngIf="!cargando" fxLayout="row wrap">

        <!-- Equipo local -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="25" fxFlex.xs="100"
            class="etiqueta">
            Equipo local:
        </div>

        <div fxFlex="70" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido">
            {{ datosPartido.equipoLocal | uppercase }}
        </div>
        
        <!-- Equipo visitante -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="25" fxFlex.xs="100"
            class="etiqueta">
            Equipo visitante:
        </div>
        
        
        <div fxFlex="70" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido">
            {{ datosPartido.equipoVisitante | uppercase }}
        </div>
        
        <!-- Fecha -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="25" fxFlex.xs="100"
            class="etiqueta">
            Fecha:
        </div>
        

        <div fxFlex="20" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido">
            {{ datosPartido.fechaHora | date:'dd/MM/yyyy' }}
        </div>

        <!-- Localidad -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="35" fxFlex.xs="100" fxFlex.sm="25"
            class="etiqueta">
            Localidad:
        </div>
        

        <div fxFlex="20" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido">
            {{ datosPartido.localidad | uppercase }}
        </div>

         <!-- Fase -->
         <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="35" fxFlex.xs="100" fxFlex.sm="25"
            class="etiqueta">
            Fase:
        </div>
        

        <div fxFlex="20" fxFlex.sm="35" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido">
            {{ datosPartido.fase }}
        </div>

        <!-- Jornada -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="25" fxFlex.xs="100"
            class="etiqueta">
            Jornada:
        </div>
        

        <div fxFlex="20" fxFlex.sm="65" fxFlex.xs="100"
            class="info-partido">
            {{ datosPartido.jornada }}
        </div>

        <!-- Otros comentarios -->
        <div fxFlex="20" fxLayoutAlign.xs="start" fxFlex.sm="25" fxFlex.xs="100"
            class="etiqueta" *ngIf="datosPartido.comentario !== ''">
            Otros datos:
        </div>
        
        <div fxFlex="70" fxFlex.xs="100" fxFlex.sm="65"
            class="info-partido" *ngIf="datosPartido.comentario !== ''">
            {{ datosPartido.comentario }}
        </div>
        
    </div>

    <!-- Listado con los cortes -->
    <h3 class="subtitulo" *ngIf="!cargando">Listado de cortes</h3>

    <div *ngIf="listadoCortes.length === 0 && !cargando" fxFlexAlign="center">
        No hay cortes asociados a este partido.
    </div>

    <mat-accordion *ngIf="listadoCortes.length > 0  && !cargando">

        <mat-expansion-panel *ngFor="let corte of listadoCortes; let i = index">
          <mat-expansion-panel-header fxLayout="row">

            <!-- Cabecera -->
            <mat-panel-title fxFlex="25">
              Corte {{(i+1)}}
            </mat-panel-title>
            <mat-panel-description fxFlex="60">
              <div class="subtitulo-valorada" *ngIf="corte.situacion">
                  {{ corte.situacion }} - {{ corte.tipo }}
                </div>
                <div class="subtitulo-no-valorada" *ngIf="!corte.situacion">
                  Jugada no valorada
              </div>
            </mat-panel-description>
          </mat-expansion-panel-header>

          <!-- Cuerpo corte -->
          <div fxLayout="row" fxLayout.md="column" fxLayout.sm="column" fxLayout.xs="column">

            <div [fxFlex]="getFxFlexVideo(corte)" fxLayoutAlign="center" fxFlex.md="100" fxFlex.sm="100" fxFlex.xs="100">
                <youtube-player class="youtube-player" [videoId]="datosPartido.url"
                    suggestedQuality="highres"
                    [height]="getYoutubePlayerWidth() / 2"
                    [width]="getYoutubePlayerWidth()"
                    [startSeconds]="corte.segundoInicio"
                    [endSeconds]="corte.segundoInicio + corte.duracion"
                    [showBeforeIframeApiLoads]="true">
                </youtube-player>
            </div>

            <div fxFlex="40" fxFlex.md="100" fxFlex.sm="100" fxFlex.xs="100" *ngIf="corte.valoracion">
                <!-- Valoración -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Valoración: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.valoracion }} </div>
                </div>

                <!-- Situación -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Situación: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.situacion }} </div>
                </div>

                <!-- Tipo -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Tipo: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.tipo }} </div>
                </div>

                <!-- Posición -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Posición: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.posicion }} </div>
                </div>

                <!-- Responsabilidad -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Responsabilidad: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.arbitro }} </div>
                </div>

                <!-- Duración del corte -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Duración: </div>
                    <div class="dato-corte" fxFlex="65" fxLayoutAlign="start"> {{ corte.duracion }} segundos </div>
                </div>

                <!-- Comentario -->
                <div class="fila-corte" fxLayout="row">
                    <div class="label-corte" fxFlex="30" fxLayoutAlign="end">Comentario: </div>
                    <div class="dato-corte" fxFlex="100" fxLayoutAlign="start"> {{ corte.comentario }} </div>
                </div>

            </div>

          </div>

          <div class="acciones-corte" fxLayout="row wrap" fxLayout.xs="column" fxLayoutAlign="center">
            <button id="eliminar-corte" (click)="eliminarCorte(corte._id!)"
                fxFlex.xs="100" mat-raised-button class="m-1">Eliminar corte</button>
            <button id="modificar-corte" (click)="modificarCorte(corte._id!)"
                fxFlex.xs="100" mat-raised-button class="m-1">Modificar corte</button>
          </div>

        </mat-expansion-panel>
      </mat-accordion>

</div>